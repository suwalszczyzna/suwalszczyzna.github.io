---
layout: post
title:  "SQL - Ściągwka podstawowych komend"
date:   2021-01-05 18:00:00 +0100
categories: sql
---

Poniżej znajduje się ściągawka podstawowych instrukcji w języku SQL na silniku bazy Oracle

( na podstawie kursu [Nieinformatyk - yt](<https://www.youtube.com/channel/UCg6KcsucpULST6rs--BNTkg>) )

Tworzenie tabeli z ID autoincrement PK (tylko Oracle DB)

```sql
CREATE TABLE locations_deleted_log(
    id NUMBER GENERATED BY DEFAULT AS IDENTITY (START WITH 1) NOT NULL PRIMARY KEY,
    deleted_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    address VARCHAR2(255),
    postal_code VARCHAR2(255),
    city VARCHAR2(255),
    state VARCHAR2(255),
    country_id CHAR(2)
);
```

```sql
-- kiedy są problemy przy zakładaniu usera
alter session
set "_ORACLE_SCRIPT" = true;

-- założenie usera i nadanie wszystkich praw
create user sklep identified by sklep;
grant all privileges to sklep;

-- Sprawdzenie na jakim jestesmy zalogowani userze
select user from dual;
```

```sql
--Tworzenie tabeli
create table pracownicy(
    id number,
    imie varchar2(30),
    nazwisko varchar2(60),
    pesel number,
    plec varchar2(1),
    data_urodzenia date,
    pensja number
);

create table produkty(
    id number,
    nazwa_produktu varchar2(100),
    typ_produktu varchar2(30),
    cena_sprzedazy number,
    cena_zakupu number,
    stawka_podatku number
);

create table departamenty
    (
    kod_departamentu number,
    nazwa_departamentu varchar2(40),
    id_kierownika number,
    miejscowosc varchar2(50)
    );
```

```sql
/* 
Dodawanie danych do tabeli
UWAGA! Po dodaniu, usunięciu czy update danych, trzeba to zacommitowac. 
Przycisk commit w edytorze sql
W innym wypadku dane będą tymczasowo w bazie, do czasu zamknięcia edytora
*/

insert into pracownicy(id, imie, nazwisko, pesel, plec, data_urodzenia, pensja)
values(1, 'Jan', 'Kowalski', 88020512345, 'M', '88/02/05', 4000);
```

```sql
-- CONSTAINS
-- Modyfikacja kolumn, dodanie constraina
alter table pracownicy
modify imie not null;

alter table pracownicy
modify plec check(plec in ('M', 'K')) not null;

alter table pracownicy
modify pesel number(11) not null;

-- dodawanie PK

alter table pracownicy
add constraint pracownicy_pk primary key(id);

alter table produkty
add constraint produkty_pk primary key(id);

alter table departamenty
add constraint departamenty_pk primary key(kod_departamentu);

-- dodanie FK

update departamenty
set id_kierownika=10
where kod_departamentu=5;

alter table departamenty
add constraint fk_dep_pracownik foreign key (id_kierownika)
references pracownicy(id);
```

```sql
create table typy_produktow(
    typ_produktu varchar2(20) primary key,
    nazwa varchar2(40) not null,
    rabat number,
    okres_waznosci varchar2(1) check (okres_waznosci in ('K', 'D'))
);

insert into typy_produktow(typ_produktu, nazwa, rabat, okres_waznosci)
values('NAP', 'napoje', null, 'D');

alter table produkty
add jm varchar2(10);
```

```sql
-- funkcje agregująće

select avg(cena_zakupu)
from produkty;
```

```sql
-- grupowanie

select kod_srodka_transportu, count(*)
from dostawcy
group by kod_srodka_transportu;

select plec, sum(pensja)
from pracownicy
group by plec;

select typ_produktu, ceil(avg(cena_sprzedazy*100))/100 Średnia
from produkty
group by typ_produktu;
```

```sql

```

```sql
-- sortowanie

select *
from pracownicy
order by data_urodzenia desc;

select *
from
(
    select *
    from pracownicy
    order by data_urodzenia
)
where ROWNUM <= 5;
```

```sql
-- joiny

select produkty.nazwa_produktu, typy_produktow.okres_waznosci
from produkty
join typy_produktow on typy_produktow.typ_produktu = produkty.typ_produktu;
```

```sql
-- podzapytania

select nazwa
from typy_produktow
where typ_produktu in ( select typ_produktu
                        from produkty
                        where cena_sprzedazy between 8 and 18);

select imie, nazwisko, pensja
from pracownicy
where pensja > ( select pensja
                 from pracownicy
                 where id=10
                );

select 
imie, 
nazwisko, 
pensja, 
(select round(avg(pensja), 2) from pracownicy) srednia_pensja
from pracownicy;
```

```sql
-- Widoki z podzapytaniami

create view ilosc_ocen as
select *
from (
    select id_przedmiotu, nazwa, wykladowca, count(ocena) ilosc_ocen
    from 
        (
        select 
            id_przedmiotu, 
            ocena, 
            przedmioty.nazwa nazwa, 
            (wykladowcy.imie || ' ' || wykladowcy.nazwisko) wykladowca
        from oceny
        join przedmioty on przedmioty.id=oceny.id_przedmiotu
        join wykladowcy on wykladowcy.id=przedmioty.id_wykladowcy
        )
    group by id_przedmiotu, nazwa, wykladowca
    having count(ocena) > 5
)
where ROWNUM <= 5
order by id_przedmiotu;
```

